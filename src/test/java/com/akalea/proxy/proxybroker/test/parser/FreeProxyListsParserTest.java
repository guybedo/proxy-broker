package com.akalea.proxy.proxybroker.test.parser;

import java.io.File;
import java.io.IOException;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

import org.apache.commons.io.FileUtils;
import org.junit.Assert;
import org.junit.Test;

import com.akalea.proxy.proxybroker.domain.Proxy;
import com.akalea.proxy.proxybroker.domain.parser.FreeProxyListsParser;
import com.google.common.collect.Sets;

import junit.framework.TestCase;

public class FreeProxyListsParserTest extends TestCase {

    @Test
    public void test() throws IOException {
        Set<String> expected =
            Sets.newHashSet(
                "104.248.244.78:8118",
                "46.63.71.13:8080",
                "84.52.83.70:52177",
                "51.15.80.136:3128",
                "88.247.10.31:8080",
                "163.53.151.2:8080",
                "84.22.198.26:8080",
                "79.115.245.227:8080",
                "24.106.221.230:53281",
                "37.111.42.210:8080",
                "64.227.14.32:8080",
                "104.244.77.254:8080",
                "91.226.5.245:32238",
                "138.197.145.103:8080",
                "110.39.52.10:61372",
                "191.97.2.51:999",
                "146.88.23.64:53281",
                "167.86.80.2:8088",
                "42.115.88.71:62225",
                "175.41.45.113:52581",
                "193.178.50.49:3128",
                "45.228.96.34:48887",
                "46.254.217.54:53281",
                "203.142.58.69:52356",
                "190.242.98.61:8083",
                "119.42.123.136:8080",
                "165.22.25.42:8118",
                "139.162.59.9:8080",
                "109.87.40.23:32444",
                "186.47.46.30:33556",
                "167.172.193.104:80",
                "36.77.27.253:8080",
                "86.57.177.8:42738",
                "198.98.50.164:8080",
                "181.129.66.138:55679",
                "200.73.128.163:8080",
                "36.92.159.69:8080",
                "200.73.128.198:80",
                "157.230.244.46:8080",
                "177.92.67.230:53281",
                "65.182.5.212:8080",
                "203.150.163.87:8080",
                "89.218.5.109:35286",
                "185.37.211.222:50330",
                "182.52.51.35:60017",
                "181.168.206.106:38024",
                "207.154.231.216:3128",
                "45.137.217.27:80",
                "148.251.200.194:1080",
                "142.93.122.175:8118",
                "85.187.245.118:53281",
                "151.253.165.70:8080",
                "200.89.178.219:80",
                "200.89.178.182:80",
                "89.109.239.183:47837",
                "5.190.132.182:8080",
                "109.172.57.250:23500",
                "64.227.6.252:8080",
                "163.172.181.33:8113",
                "85.159.48.170:40014",
                "138.68.173.29:3128",
                "51.38.71.101:8080",
                "212.33.28.54:8080",
                "103.250.152.30:48004",
                "35.240.173.31:3128",
                "207.154.231.213:8080",
                "110.74.222.213:52733",
                "185.200.38.56:8080",
                "180.94.64.114:8080",
                "119.82.252.115:49085",
                "103.21.42.58:23500",
                "178.215.190.239:60359",
                "182.52.51.10:53965",
                "129.205.210.90:65205",
                "68.183.208.248:80",
                "151.80.199.89:3128",
                "148.251.200.197:1080",
                "91.207.147.243:38472",
                "139.180.163.43:8080",
                "163.172.28.22:80",
                "167.99.200.201:3128",
                "179.124.19.9:38163",
                "178.63.246.83:8118",
                "83.167.73.151:59871",
                "190.5.237.166:3128",
                "118.69.56.68:55184",
                "36.82.239.100:8080",
                "170.244.97.61:80",
                "103.194.171.156:8888",
                "113.252.95.19:8197",
                "110.172.160.66:36175",
                "202.138.247.155:8080",
                "35.223.140.81:80",
                "202.93.228.150:39081",
                "122.102.28.179:53281",
                "2020-02-12:1969",
                "159.138.22.112:80",
                "45.231.28.162:8080",
                "45.71.115.1:53281",
                "177.46.148.142:3128",
                "81.24.88.231:8081",
                "96.9.86.70:41916",
                "178.62.246.161:8080",
                "170.246.115.106:8081",
                "51.79.51.43:8080",
                "193.176.212.195:8080",
                "159.138.1.185:80",
                "3.8.1.12:80",
                "190.152.5.126:53040",
                "190.7.141.66:30900",
                "160.2.52.234:8080",
                "180.250.101.146:8080",
                "125.27.251.160:48467",
                "200.152.78.48:38543",
                "138.197.157.45:8080",
                "200.29.24.36:57900",
                "94.130.9.98:80",
                "217.113.19.196:81",
                "77.58.96.177:80",
                "143.255.52.25:44298",
                "101.128.68.113:8080",
                "103.25.168.22:38448",
                "159.203.188.121:8118",
                "79.175.151.181:4261",
                "212.42.113.240:37545",
                "27.116.21.220:8080",
                "82.99.242.20:3128",
                "59.91.122.1:54086",
                "102.176.197.253:56580",
                "27.68.135.14:30199",
                "46.151.108.6:30874",
                "182.52.238.119:40456",
                "181.191.106.122:43716",
                "89.218.133.170:43161",
                "196.14.52.63:35048",
                "115.127.114.76:32343",
                "47.52.247.217:808",
                "34.90.113.143:3128",
                "91.234.127.222:53281",
                "85.10.219.102:1080",
                "46.49.121.187:52101",
                "37.57.216.4:4444",
                "14.162.145.116:55055",
                "178.75.27.131:41879",
                "111.223.252.42:8080",
                "206.72.203.42:80",
                "2020-02-09:1938",
                "68.183.45.111:8118",
                "207.154.231.217:3128",
                "37.71.165.99:80",
                "118.172.227.89:60035",
                "5.23.102.194:52803",
                "185.131.60.103:53281",
                "103.105.212.106:53281",
                "91.207.60.241:1182",
                "180.183.128.62:8213",
                "169.57.157.148:80",
                "186.249.192.102:8080",
                "186.250.29.1:53281",
                "1.2.169.49:36335",
                "77.94.144.164:3128",
                "185.64.208.90:53281",
                "88.198.24.108:8080",
                "103.76.190.210:49939",
                "81.28.164.55:52658",
                "68.183.211.110:8080",
                "185.69.198.222:8080",
                "1.20.101.24:41064",
                "186.229.25.18:8080",
                "103.201.140.6:84",
                "180.210.201.57:3130",
                "159.93.65.191:80",
                "91.236.61.65:8080",
                "1.20.100.227:57396",
                "191.102.124.3:999",
                "51.158.99.51:8811",
                "46.150.170.10:53281",
                "182.160.117.130:53281",
                "1.2.169.12:47678",
                "186.226.183.170:30698",
                "200.69.204.203:3128",
                "213.58.202.70:54214",
                "179.189.225.58:41881",
                "197.242.206.105:46640",
                "103.102.67.33:63141",
                "131.255.186.2:8080",
                "115.87.205.96:8213",
                "61.7.184.220:53281",
                "178.124.194.74:3128",
                "2020-02-10:1944",
                "190.11.15.2:59274",
                "36.78.221.127:8080",
                "190.151.94.3:46615",
                "182.180.62.55:53281",
                "178.57.89.142:40208",
                "125.62.213.134:83",
                "203.176.135.98:59691",
                "181.30.28.12:3128",
                "43.225.192.241:50878",
                "221.141.130.183:33741",
                "181.129.142.178:8080",
                "198.143.181.165:3128",
                "138.121.32.26:23500",
                "41.79.197.150:8080",
                "176.9.75.42:8080",
                "148.217.200.135:3128",
                "195.138.82.198:40301",
                "147.215.150.71:80",
                "2020-02-13:1556",
                "149.129.216.12:3128",
                "103.111.83.26:36549",
                "189.51.98.182:56906",
                "170.244.88.67:53281",
                "45.123.25.77:37761",
                "144.217.163.138:8080",
                "190.167.215.170:52479",
                "91.205.51.27:49805",
                "115.127.109.2:45067",
                "139.99.89.133:8080",
                "187.73.68.14:53281",
                "45.112.57.110:56363",
                "200.255.122.170:8080",
                "189.113.217.35:42517",
                "185.86.4.55:3128",
                "207.148.113.239:80",
                "195.69.221.198:54418",
                "125.26.99.223:38308",
                "191.242.189.13:8080",
                "200.89.178.230:8080",
                "95.143.8.182:57169",
                "167.71.202.109:8080",
                "195.191.250.38:3128",
                "138.68.165.154:3128",
                "182.53.197.156:34816",
                "124.122.178.238:8213",
                "118.175.93.171:32866",
                "139.255.122.117:8080",
                "223.25.101.242:59504",
                "202.52.234.236:35931",
                "150.129.250.28:33846",
                "200.89.178.231:8080",
                "103.12.161.196:39543",
                "200.85.169.18:48101",
                "5.135.181.83:80",
                "95.68.11.4:53281",
                "208.255.161.107:8180",
                "2020-02-11:2098",
                "46.4.96.137:3128",
                "139.99.90.87:8080",
                "180.183.104.54:3128",
                "51.158.111.229:8811",
                "203.150.123.120:8080",
                "170.82.231.26:56805",
                "72.169.67.61:87",
                "5.9.201.68:3128",
                "192.117.146.110:80",
                "191.255.227.88:8080",
                "87.118.250.34:8080",
                "177.37.240.52:8080",
                "47.75.0.250:808",
                "27.111.38.137:39850",
                "185.204.202.199:8080",
                "178.75.21.109:36143",
                "213.110.122.220:56871",
                "170.81.35.26:36681",
                "5.188.155.159:3128",
                "161.132.101.142:35311",
                "118.173.233.31:59669",
                "181.192.25.141:8080",
                "94.200.195.218:8080",
                "37.17.12.33:34137",
                "186.159.2.241:43459",
                "36.78.184.209:8080",
                "103.233.10.165:80",
                "201.87.243.22:8080",
                "138.68.161.60:8080",
                "108.74.113.180:80",
                "36.89.150.245:8080",
                "124.41.240.203:55948",
                "62.24.109.15:50877",
                "182.52.51.53:60441",
                "111.125.87.199:53281",
                "200.116.226.210:43049",
                "34.83.108.137:3128",
                "103.78.213.226:45075",
                "189.43.68.174:80",
                "181.143.157.242:50942",
                "115.75.1.156:38351",
                "36.72.228.77:8080",
                "185.122.57.238:3128",
                "80.48.119.28:8080",
                "122.102.41.82:55783",
                "172.104.240.85:80",
                "176.9.119.170:8080",
                "149.56.99.222:80",
                "188.227.195.66:8080",
                "36.89.240.9:8080",
                "36.79.158.247:8080",
                "189.43.68.168:80",
                "200.89.178.214:3128",
                "202.179.7.182:56506",
                "41.73.15.130:80",
                "118.174.220.32:51399",
                "186.233.98.173:23500",
                "45.32.177.5:31285");

        List<Proxy> proxies =
            new FreeProxyListsParser().parse(
                FileUtils.readFileToString(
                    new File(
                        this.getClass()
                            .getClassLoader()
                            .getResource("free-proxy-list.html")
                            .getFile())));
        Set<String> actual =
            proxies
                .stream()
                .map(p -> p.getUrl())
                .collect(Collectors.toSet());
        Assert.assertEquals(expected, actual);
    }

}
